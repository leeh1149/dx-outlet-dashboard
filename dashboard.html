<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DX OUTLET ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: bold;
            color: #555;
        }

        .filter-group select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            min-width: 200px;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #666;
            font-size: 0.9em;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .group-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .group-header h1 {
            font-size: 1.8em;
            margin: 0;
        }

        .group-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .tab-navigation {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .tab-button {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #666;
            border: 2px solid transparent;
        }

        .tab-button:hover {
            background: #e9ecef;
            color: #333;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 2px solid #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .chart-container {
            margin: 20px 0;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group select {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸª DX OUTLET ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ</h1>
        <p>ì‹¤ì‹œê°„ ë°ì´í„° ë¶„ì„ ë° ì‹œê°í™”</p>
    </div>

    <div class="container">
        <!-- ë°ì´í„° ë¡œë“œ ì„¹ì…˜ -->
        <div class="section">
            <h2>ğŸ“ ë°ì´í„° ë¡œë“œ</h2>
            <div style="text-align: center; padding: 20px;">
                <button id="loadDataBtn" style="
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    font-size: 16px;
                    border-radius: 25px;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                    transition: transform 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    ğŸ“Š ë°ì´í„° ìë™ ë¡œë“œ
                </button>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    AI_STUDY í´ë”ì˜ DX OUTLET MS DB.csv íŒŒì¼ì„ ìë™ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤
                </p>
                <p id="loadStatus" style="margin-top: 10px; font-size: 14px; font-weight: bold;">
                    ğŸ”„ ë°ì´í„° ë¡œë“œë¥¼ ì‹œì‘í•˜ë ¤ë©´ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
                </p>
            </div>
        </div>

        <!-- í•„í„° ì„¹ì…˜ -->
        <div class="filters" id="filtersSection" style="display: none;">
            <div class="filter-group">
                <label for="distributor">ìœ í†µì‚¬ ì„ íƒ</label>
                <select id="distributor">
                    <option value="ì „ì²´">ì „ì²´</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="store">ë§¤ì¥ëª… ì„ íƒ</label>
                <select id="store">
                    <option value="ì „ì²´">ì „ì²´</option>
                </select>
            </div>
        </div>

        <!-- ë©”íŠ¸ë¦­ ì¹´ë“œ -->
        <div class="metrics" id="metricsSection" style="display: none;">
            <div class="metric-card">
                <div class="metric-value" id="selectedDistributor">ì „ì²´</div>
                <div class="metric-label">ì„ íƒëœ ìœ í†µì‚¬</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="selectedStore">ì „ì²´</div>
                <div class="metric-label">ì„ íƒëœ ë§¤ì¥</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="dataCount">0</div>
                <div class="metric-label">ë°ì´í„° ê±´ìˆ˜</div>
            </div>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="showPage('outletTrendsPage')">
                ğŸª ì•„ìš¸ë › ë™í–¥
            </button>
            <button class="tab-button" onclick="showPage('storeEfficiencyPage')">
                ğŸ“Š ë§¤ì¥ íš¨ìœ¨
            </button>
        </div>

        <!-- ì•„ìš¸ë › ë™í–¥ í˜ì´ì§€ -->
        <div class="page active" id="outletTrendsPage">
            <div class="group" id="outletTrendsGroup">
            <div class="group-header">
                <h1>ğŸª ì•„ìš¸ë › ë™í–¥</h1>
            </div>
            <div class="group-content">
        <!-- ì•„ìš¸ë › ë§¤ì¶œ íë¦„ -->
                <div class="section" id="outletSection">
                    <h2>ğŸ“ˆ ì•„ìš¸ë › ë§¤ì¶œ íë¦„ - ë””ìŠ¤ì»¤ë²„ë¦¬</h2>
            
            <!-- ìœ í†µì‚¬ë³„ ì´ë§¤ì¶œ ë° í‰ê· ë§¤ì¶œ í‘œ -->
            <div class="table-container" style="margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #333; margin: 0;">ìœ í†µì‚¬ë³„ ë””ìŠ¤ì»¤ë²„ë¦¬ ì´ë§¤ì¶œ ë° í‰ê· ë§¤ì¶œ</h3>
                    <div style="display: flex; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="seasonType" value="SS" checked style="margin: 0;">
                            <span>SS ì‹œì¦Œ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="seasonType" value="FW" style="margin: 0;">
                            <span>FW ì‹œì¦Œ</span>
                        </label>
                    </div>
                </div>
                <table id="summaryTable">
                    <thead id="summaryTableHead">
                        <tr>
                            <th>ìœ í†µì‚¬</th>
                            <th>ë§¤ì¥ìˆ˜</th>
                            <th>25SS ì´ë§¤ì¶œ</th>
                            <th>25SS ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                            <th>24SS ì´ë§¤ì¶œ</th>
                            <th>24SS ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                            <th>SS ì´ë§¤ì¶œ ì „ë…„ë¹„</th>
                            <th>25SS í‰ê· ë§¤ì¶œ</th>
                            <th>25SS í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                            <th>24SS í‰ê· ë§¤ì¶œ</th>
                            <th>24SS í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                            <th>SS í‰ê· ë§¤ì¶œ ì „ë…„ë¹„</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <!-- ì‹œì¦Œë³„ ë§¤ì¶œ íë¦„ ì°¨íŠ¸ -->
            <!-- SS ì‹œì¦Œ ë§¤ì¶œ ë¹„êµ ì°¨íŠ¸ -->
            <div class="chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #333; margin: 0;">ìœ í†µì‚¬ë³„ ë””ìŠ¤ì»¤ë²„ë¦¬ SS ì‹œì¦Œ ë§¤ì¶œ ë¹„êµ</h3>
                    <div style="display: flex; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="ssChartDataType" value="total" checked style="margin: 0;">
                            <span>ì´ ë§¤ì¶œ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="ssChartDataType" value="average" style="margin: 0;">
                            <span>í‰ê·  ë§¤ì¶œ</span>
                        </label>
                    </div>
                </div>
                <div id="ssSeasonalFlowChart"></div>
            </div>
            
            <!-- FW ì‹œì¦Œ ë§¤ì¶œ ë¹„êµ ì°¨íŠ¸ -->
            <div class="chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #333; margin: 0;">ìœ í†µì‚¬ë³„ ë””ìŠ¤ì»¤ë²„ë¦¬ FW ì‹œì¦Œ ë§¤ì¶œ ë¹„êµ</h3>
                    <div style="display: flex; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="fwChartDataType" value="total" checked style="margin: 0;">
                            <span>ì´ ë§¤ì¶œ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="fwChartDataType" value="average" style="margin: 0;">
                            <span>í‰ê·  ë§¤ì¶œ</span>
                        </label>
                    </div>
                </div>
                <div id="fwSeasonalFlowChart"></div>
            </div>
            
            <!-- ìƒì„¸ ì‹œì¦Œë³„ ë§¤ì¶œ í‘œ -->
            <div class="table-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #333; margin: 0;">ìœ í†µì‚¬ë³„ ë””ìŠ¤ì»¤ë²„ë¦¬ ì‹œì¦Œë³„ ìƒì„¸ ë§¤ì¶œ</h3>
                    <div style="display: flex; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="distributorDataType" value="total" checked style="margin: 0;">
                            <span>ì´ ë§¤ì¶œ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="distributorDataType" value="average" style="margin: 0;">
                            <span>í‰ê·  ë§¤ì¶œ</span>
                        </label>
                    </div>
                </div>
                <table id="distributorTable">
                    <thead id="distributorTableHead">
                        <tr>
                            <th>ìœ í†µì‚¬</th>
                            <th>ë§¤ì¥ìˆ˜</th>
                            <th>25SS</th>
                            <th>24SS</th>
                            <th>SS ì „ë…„ë¹„</th>
                            <th>24FW</th>
                            <th>23FW</th>
                            <th>FW ì „ë…„ë¹„</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ë™ì—…ê³„ MS í˜„í™© -->
                <div class="section" id="msSection">
            <h2>ğŸ¢ ë™ì—…ê³„ MS í˜„í™©</h2>
            
            <!-- ì‹œì¦Œ ì„ íƒ -->
            <div style="display: flex; justify-content: center; margin-bottom: 20px;">
                <div style="display: flex; gap: 20px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: bold; cursor: pointer;">
                        <input type="radio" name="msSeasonType" value="SS" checked style="margin: 0; transform: scale(1.2);">
                        <span>SS ì‹œì¦Œ</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: bold; cursor: pointer;">
                        <input type="radio" name="msSeasonType" value="FW" style="margin: 0; transform: scale(1.2);">
                        <span>FW ì‹œì¦Œ</span>
                    </label>
                </div>
            </div>
            
            <!-- ì„ íƒëœ ì‹œì¦Œ ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ -->
            <div class="chart-container">
                <h3 id="msChartTitle" style="color: #333; margin-bottom: 15px;">SS ì‹œì¦Œ ë§¤ì¶œ í˜„í™©</h3>
                <div id="msSelectedChart"></div>
            </div>
            
            <!-- MS í˜„í™© í‘œ -->
            <div class="table-container">
                <h3 style="color: #333; margin-bottom: 15px;">ë¸Œëœë“œë³„ ë§¤ì¶œ ìˆœìœ„</h3>
                <table id="msTable">
                    <thead>
                        <tr id="msTableHead">
                            <th>ìˆœìœ„</th>
                            <th>ë¸Œëœë“œ</th>
                            <th>25SS</th>
                            <th>24SS</th>
                            <th>SS ì „ë…„ë¹„</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
                </div>
                </div>
            </div>

        <!-- ë§¤ì¥ íš¨ìœ¨ í˜ì´ì§€ -->
        <div class="page" id="storeEfficiencyPage">
            <div class="group" id="storeEfficiencyGroup">
                <div class="group-header">
                    <h1>ğŸ“Š ë§¤ì¥ íš¨ìœ¨</h1>
                </div>
                <div class="group-content">
                    <!-- ë§¤ì¥ íš¨ìœ¨ ë¶„ì„ ì„¹ì…˜ -->
                    <div class="section">
                        <h2>ğŸš€ ë””ìŠ¤ì»¤ë²„ë¦¬ ë§¤ì¥ íš¨ìœ¨ ë¶„ì„</h2>
                        <p style="color: #666; margin-bottom: 20px;">
                            ë””ìŠ¤ì»¤ë²„ë¦¬ ë¸Œëœë“œ ë§¤ì¥ë³„ í‰ìˆ˜ ëŒ€ë¹„ ì‹œì¦Œë³„ ë§¤ì¶œì•¡ íš¨ìœ¨ì„±ì„ ë¶„ì„í•©ë‹ˆë‹¤. (í‰ë‹¹ ë§¤ì¶œì•¡ ê¸°ì¤€)
                        </p>
                        
                        <!-- íš¨ìœ¨ì„± ìˆœìœ„ í‘œ -->
                        <div class="chart-container">
                            <h3 style="color: #333; margin-bottom: 15px;">ë””ìŠ¤ì»¤ë²„ë¦¬ ë§¤ì¥ë³„ í‰ê·  íš¨ìœ¨ì„± ìˆœìœ„ (í‰ë‹¹ ë§¤ì¶œì•¡ ê¸°ì¤€)</h3>
                            <div id="efficiencyRankingTable"></div>
                        </div>
                        
                        <!-- ì‹œì¦Œë³„ íš¨ìœ¨ì„± íˆíŠ¸ë§µ -->
                        <div class="chart-container">
                            <h3 style="color: #333; margin-bottom: 15px;">ë””ìŠ¤ì»¤ë²„ë¦¬ ë§¤ì¥ ì‹œì¦Œë³„ íš¨ìœ¨ì„± íˆíŠ¸ë§µ</h3>
                            <div id="efficiencyHeatmapChart"></div>
                        </div>
                        
                        <!-- ë§¤ì¥ë©´ì  vs íš¨ìœ¨ì„± ì‚°ì ë„ -->
                        <div class="chart-container">
                            <h3 style="color: #333; margin-bottom: 15px;">ë””ìŠ¤ì»¤ë²„ë¦¬ ë§¤ì¥ë©´ì  vs í‰ê· íš¨ìœ¨ì„±</h3>
                            <div id="areaVsEfficiencyChart"></div>
                        </div>
                        
                        <!-- ì‹œì¦Œë³„ ë§¤ì¶œì•¡ íŠ¸ë Œë“œ -->
                        <div class="chart-container">
                            <h3 style="color: #333; margin-bottom: 15px;">ë””ìŠ¤ì»¤ë²„ë¦¬ ìƒìœ„ ë§¤ì¥ì˜ ì‹œì¦Œë³„ ë§¤ì¶œì•¡ íŠ¸ë Œë“œ</h3>
                            <div id="seasonalTrendChart"></div>
                        </div>
                        
                        <!-- ì„ íƒëœ ë§¤ì¥ ìƒì„¸ ì •ë³´ -->
                        <div class="section" id="selectedStoreDetails" style="display: none;">
                            <h2>ğŸª ì„ íƒëœ ë§¤ì¥ ìƒì„¸ ì •ë³´</h2>
                            <div id="storeDetailsContent"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        let rawData = [];
        let filteredData = [];

        // ì–µì› ë‹¨ìœ„ ë³€í™˜ í•¨ìˆ˜
        function formatToHundredMillion(value) {
            const hundredMillion = value / 100000000; // ì–µì› ë‹¨ìœ„ë¡œ ë³€í™˜
            return hundredMillion.toFixed(1) + 'ì–µì›';
        }

        // CSV íŒŒì¼ ìë™ ë¡œë“œ
        function loadData() {
            // CSV íŒŒì¼ì„ ì§ì ‘ fetchë¡œ ë¡œë“œ
            fetch('DX OUTLET MS DB.csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('CSV íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    return response.text();
                })
                .then(csvText => {
                    Papa.parse(csvText, {
                        header: true,
                        complete: function(results) {
                            rawData = results.data;
                            filteredData = [...rawData];
                            initializeDashboard();
                            
                            // ë¡œë“œ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                            updateLoadStatus('âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ', 'success');
                        },
                        error: function(error) {
                            console.error('CSV íŒŒì‹± ì—ëŸ¬:', error);
                            showError('ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                            updateLoadStatus('âŒ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜', 'error');
                        }
                    });
                })
                .catch(error => {
                    console.error('CSV íŒŒì¼ ë¡œë“œ ì—ëŸ¬:', error);
                    showError('CSV íŒŒì¼ì„ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    updateLoadStatus('âŒ íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜', 'error');
                });
        }
        
        // ë¡œë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateLoadStatus(message, type) {
            const statusElement = document.getElementById('loadStatus');
            if (statusElement) {
                statusElement.textContent = message;
                if (type === 'success') {
                    statusElement.style.color = '#28a745';
                } else if (type === 'error') {
                    statusElement.style.color = '#dc3545';
                } else if (type === 'loading') {
                    statusElement.style.color = '#007bff';
                }
            }
        }

        function showError(message) {
            const container = document.querySelector('.container');
            container.innerHTML = `
                <div class="error">
                    <h3>ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        function initializeDashboard() {
            // ì„¹ì…˜ë“¤ í‘œì‹œ
            document.getElementById('filtersSection').style.display = 'flex';
            document.getElementById('metricsSection').style.display = 'grid';
            
            setupFilters();
            updateMetrics();
            updateCharts();
            updateTables();
        }

        function setupFilters() {
            const distributorSelect = document.getElementById('distributor');
            const storeSelect = document.getElementById('store');

            // ìœ í†µì‚¬ ëª©ë¡ ìƒì„±
            const distributors = [...new Set(rawData.map(row => row['ìœ í†µì‚¬']))].filter(Boolean);
            distributors.forEach(distributor => {
                const option = document.createElement('option');
                option.value = distributor;
                option.textContent = distributor;
                distributorSelect.appendChild(option);
            });

            // ë§¤ì¥ëª… ëª©ë¡ ìƒì„±
            const stores = [...new Set(rawData.map(row => row['ë§¤ì¥ëª…']))].filter(Boolean);
            stores.forEach(store => {
                const option = document.createElement('option');
                option.value = store;
                option.textContent = store;
                storeSelect.appendChild(option);
            });

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            distributorSelect.addEventListener('change', function() {
                updateStoreOptions();
                filterData();
            });

            storeSelect.addEventListener('change', function() {
                filterData();
            });
        }

        function updateStoreOptions() {
            const distributorSelect = document.getElementById('distributor');
            const storeSelect = document.getElementById('store');
            const selectedDistributor = distributorSelect.value;

            // ë§¤ì¥ëª… ì˜µì…˜ ì´ˆê¸°í™”
            storeSelect.innerHTML = '<option value="ì „ì²´">ì „ì²´</option>';

            if (selectedDistributor !== 'ì „ì²´') {
                const stores = [...new Set(
                    rawData
                        .filter(row => row['ìœ í†µì‚¬'] === selectedDistributor)
                        .map(row => row['ë§¤ì¥ëª…'])
                )].filter(Boolean);

                stores.forEach(store => {
                    const option = document.createElement('option');
                    option.value = store;
                    option.textContent = store;
                    storeSelect.appendChild(option);
                });
            }
        }

        function filterData() {
            const distributorSelect = document.getElementById('distributor');
            const storeSelect = document.getElementById('store');
            const selectedDistributor = distributorSelect.value;
            const selectedStore = storeSelect.value;

            filteredData = rawData.filter(row => {
                const distributorMatch = selectedDistributor === 'ì „ì²´' || row['ìœ í†µì‚¬'] === selectedDistributor;
                const storeMatch = selectedStore === 'ì „ì²´' || row['ë§¤ì¥ëª…'] === selectedStore;
                return distributorMatch && storeMatch;
            });

            updateMetrics();
            // ì•„ìš¸ë › ë§¤ì¶œ íë¦„ì€ í•„í„°ì™€ ë¬´ê´€í•˜ê²Œ ê³ ì •ì´ë¯€ë¡œ ì œì™¸
            updateMSCharts();
        }

        function updateMetrics() {
            document.getElementById('selectedDistributor').textContent = 
                document.getElementById('distributor').value;
            document.getElementById('selectedStore').textContent = 
                document.getElementById('store').value;
            document.getElementById('dataCount').textContent = filteredData.length;
        }

        function updateCharts() {
            // ì•„ìš¸ë › ë§¤ì¶œ íë¦„ì€ ë””ìŠ¤ì»¤ë²„ë¦¬ ë¸Œëœë“œë§Œ í‘œì‹œ
            updateDistributorCharts();
            updateMSCharts();
        }

        function updateDistributorCharts() {
            // ì•„ìš¸ë › ë§¤ì¶œ íë¦„ì€ ë””ìŠ¤ì»¤ë²„ë¦¬ ë¸Œëœë“œë§Œ í‘œì‹œ
            const distributorData = {};
            const discoveryData = rawData.filter(row => row['ë¸Œëœë“œ'] === 'ë””ìŠ¤ì»¤ë²„ë¦¬');
            const distributors = [...new Set(discoveryData.map(row => row['ìœ í†µì‚¬']))].filter(Boolean);

            distributors.forEach(distributor => {
                const distributorRows = discoveryData.filter(row => row['ìœ í†µì‚¬'] === distributor);
                const seasonColumns = ['23SS', '23FW', '24SS', '24FW', '25SS'];
                
                const seasonTotals = seasonColumns.map(season => 
                    distributorRows.reduce((sum, row) => sum + (parseInt(row[season]) || 0), 0)
                );
                
                const totalSales = seasonTotals.reduce((sum, val) => sum + val, 0);
                const avgSales = totalSales / seasonColumns.length;

                // ë§¤ì¥ ìˆ˜ ê³„ì‚°
                const storeCount = [...new Set(distributorRows.map(row => row['ë§¤ì¥ëª…']))].length;

                // SS ì‹œì¦Œ ë°ì´í„°
                const ss2025 = seasonTotals[4]; // 25SS
                const ss2024 = seasonTotals[2]; // 24SS
                const avgSS2025 = ss2025 / storeCount;
                const avgSS2024 = ss2024 / storeCount;

                // FW ì‹œì¦Œ ë°ì´í„°
                const fw2024 = seasonTotals[3]; // 24FW
                const fw2023 = seasonTotals[1]; // 23FW
                const avgFW2024 = fw2024 / storeCount;
                const avgFW2023 = fw2023 / storeCount;

                distributorData[distributor] = {
                    totalSales,
                    avgSales,
                    seasonTotals,
                    storeCount,
                    ss2025,
                    ss2024,
                    avgSS2025,
                    avgSS2024,
                    fw2024,
                    fw2023,
                    avgFW2024,
                    avgFW2023
                };
            });

            // ìš”ì•½ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateSummaryTable(distributorData);

            // ì‹œì¦Œë³„ ë§¤ì¶œ íë¦„ ì°¨íŠ¸
            const seasons = ['23SS', '23FW', '24SS', '24FW', '25SS'];
            const seasonLabels = ['2023 SS', '2023 FW', '2024 SS', '2024 FW', '2025 SS'];
            
            // SS ì°¨íŠ¸ ë°ì´í„° êµ¬ì„±
            const selectedSSDataType = document.querySelector('input[name="ssChartDataType"]:checked').value;
            
            let ssData;
            let ssChartTitle;
            
            if (selectedSSDataType === 'total') {
                ssData = [{
                    x: distributors,
                    y: distributors.map(distributor => distributorData[distributor].ss2025 / 100000000),
                    type: 'bar',
                    name: '25SS',
                    marker: { color: '#1f77b4' }
                }, {
                    x: distributors,
                    y: distributors.map(distributor => distributorData[distributor].ss2024 / 100000000),
                    type: 'bar',
                    name: '24SS',
                    marker: { color: '#ff7f0e' }
                }];
                ssChartTitle = 'ìœ í†µì‚¬ë³„ ë””ìŠ¤ì»¤ë²„ë¦¬ SS ì‹œì¦Œ ì´ ë§¤ì¶œ ë¹„êµ';
            } else {
                ssData = [{
                    x: distributors,
                    y: distributors.map(distributor => distributorData[distributor].avgSS2025 / 100000000),
                    type: 'bar',
                    name: '25SS í‰ê· ',
                    marker: { color: '#1f77b4' }
                }, {
                    x: distributors,
                    y: distributors.map(distributor => distributorData[distributor].avgSS2024 / 100000000),
                    type: 'bar',
                    name: '24SS í‰ê· ',
                    marker: { color: '#ff7f0e' }
                }];
                ssChartTitle = 'ìœ í†µì‚¬ë³„ ë””ìŠ¤ì»¤ë²„ë¦¬ SS ì‹œì¦Œ í‰ê·  ë§¤ì¶œ ë¹„êµ';
            }

            Plotly.newPlot('ssSeasonalFlowChart', ssData, {
                title: ssChartTitle,
                xaxis: { title: 'ìœ í†µì‚¬' },
                yaxis: { title: selectedSSDataType === 'total' ? 'ì´ ë§¤ì¶œ (ì–µì›)' : 'í‰ê·  ë§¤ì¶œ (ì–µì›)' },
                barmode: 'group'
            });

            // FW ì°¨íŠ¸ ë°ì´í„° êµ¬ì„±
            const selectedFWDataType = document.querySelector('input[name="fwChartDataType"]:checked').value;
            
            let fwData;
            let fwChartTitle;
            
            if (selectedFWDataType === 'total') {
                fwData = [{
                    x: distributors,
                    y: distributors.map(distributor => distributorData[distributor].fw2024 / 100000000),
                    type: 'bar',
                    name: '24FW',
                    marker: { color: '#2ca02c' }
                }, {
                    x: distributors,
                    y: distributors.map(distributor => distributorData[distributor].fw2023 / 100000000),
                    type: 'bar',
                    name: '23FW',
                    marker: { color: '#d62728' }
                }];
                fwChartTitle = 'ìœ í†µì‚¬ë³„ ë””ìŠ¤ì»¤ë²„ë¦¬ FW ì‹œì¦Œ ì´ ë§¤ì¶œ ë¹„êµ';
            } else {
                fwData = [{
                    x: distributors,
                    y: distributors.map(distributor => distributorData[distributor].avgFW2024 / 100000000),
                    type: 'bar',
                    name: '24FW í‰ê· ',
                    marker: { color: '#2ca02c' }
                }, {
                    x: distributors,
                    y: distributors.map(distributor => distributorData[distributor].avgFW2023 / 100000000),
                    type: 'bar',
                    name: '23FW í‰ê· ',
                    marker: { color: '#d62728' }
                }];
                fwChartTitle = 'ìœ í†µì‚¬ë³„ ë””ìŠ¤ì»¤ë²„ë¦¬ FW ì‹œì¦Œ í‰ê·  ë§¤ì¶œ ë¹„êµ';
            }

            Plotly.newPlot('fwSeasonalFlowChart', fwData, {
                title: fwChartTitle,
                xaxis: { title: 'ìœ í†µì‚¬' },
                yaxis: { title: selectedFWDataType === 'total' ? 'ì´ ë§¤ì¶œ (ì–µì›)' : 'í‰ê·  ë§¤ì¶œ (ì–µì›)' },
                barmode: 'group'
            });
        }

        function updateMSCharts() {
            // ë¸Œëœë“œë³„ ë°ì´í„° ì§‘ê³„
            const brands = [...new Set(filteredData.map(row => row['ë¸Œëœë“œ']))].filter(Boolean);
            const msData = {};

            brands.forEach(brand => {
                const brandRows = filteredData.filter(row => row['ë¸Œëœë“œ'] === brand);
                
                const ss2025 = brandRows.reduce((sum, row) => sum + (parseInt(row['25SS']) || 0), 0);
                const ss2024 = brandRows.reduce((sum, row) => sum + (parseInt(row['24SS']) || 0), 0);
                const fw2024 = brandRows.reduce((sum, row) => sum + (parseInt(row['24FW']) || 0), 0);
                const fw2023 = brandRows.reduce((sum, row) => sum + (parseInt(row['23FW']) || 0), 0);
                
                const ssGrowth = ss2024 !== 0 ? ((ss2025 - ss2024) / ss2024 * 100) : 0;
                const fwGrowth = fw2023 !== 0 ? ((fw2024 - fw2023) / fw2023 * 100) : 0;

                msData[brand] = {
                    ss2025, ss2024, fw2024, fw2023, ssGrowth, fwGrowth
                };
            });

            // ì„ íƒëœ ì‹œì¦Œì— ë”°ë¼ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateMSSelectedChart(msData);
            updateMSTable(msData);
        }

        function updateMSSelectedChart(msData) {
            const selectedSeason = document.querySelector('input[name="msSeasonType"]:checked').value;
            
            if (selectedSeason === 'SS') {
            // SS ì‹œì¦Œ ë°ì´í„°ë¥¼ ë§¤ì¶œ ìˆœìœ¼ë¡œ ì •ë ¬
            const ssSortedData = Object.entries(msData)
                .sort(([,a], [,b]) => b.ss2025 - a.ss2025);
            
            const ssBrands = ssSortedData.map(([brand]) => brand);
            const ss2025Values = ssSortedData.map(([,data]) => data.ss2025);
            const ss2024Values = ssSortedData.map(([,data]) => data.ss2024);
            
            // SS ì´ ë§¤ì¶œ ê³„ì‚° (êµ¬ì„±ë¹„ìš©)
            const ssTotal = ss2025Values.reduce((sum, val) => sum + val, 0);
            
            const ssData = [{
                x: ssBrands,
                y: ss2025Values,
                type: 'bar',
                name: '25SS',
                marker: { 
                    color: ssBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? '#FF6B35' : '#1f77b4'),
                    line: { 
                        color: ssBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? '#FF4500' : '#1f77b4'),
                        width: ssBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? 3 : 1)
                    }
                },
                text: ss2025Values.map(val => `${val.toLocaleString()}<br><span style="font-size: 0.8em;">(${((val/ssTotal)*100).toFixed(1)}%)</span>`),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>25SS: %{y:,.0f}<br>êµ¬ì„±ë¹„: %{customdata:.1f}%<extra></extra>',
                customdata: ss2025Values.map(val => (val/ssTotal)*100)
            }, {
                x: ssBrands,
                y: ss2024Values,
                type: 'bar',
                name: '24SS',
                marker: { 
                    color: ssBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? '#FF8C42' : '#ff7f0e'),
                    line: { 
                        color: ssBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? '#FF4500' : '#ff7f0e'),
                        width: ssBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? 3 : 1)
                    }
                },
                text: ss2024Values.map(val => `${val.toLocaleString()}<br><span style="font-size: 0.8em;">(${((val/ssTotal)*100).toFixed(1)}%)</span>`),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>24SS: %{y:,.0f}<br>êµ¬ì„±ë¹„: %{customdata:.1f}%<extra></extra>',
                customdata: ss2024Values.map(val => (val/ssTotal)*100)
            }];

                Plotly.newPlot('msSelectedChart', ssData, {
                title: 'SS ì‹œì¦Œ ë§¤ì¶œ í˜„í™© (ë†’ì€ ë§¤ì¶œ ìˆœ)',
                xaxis: { title: 'ë¸Œëœë“œ' },
                yaxis: { title: 'ë§¤ì¶œ (ì–µì›)' },
                barmode: 'group'
            });

                document.getElementById('msChartTitle').textContent = 'SS ì‹œì¦Œ ë§¤ì¶œ í˜„í™©';
            } else {
                // FW ì‹œì¦Œ ë°ì´í„°ë¥¼ ë§¤ì¶œ ìˆœìœ¼ë¡œ ì •ë ¬
                const fwSortedData = Object.entries(msData)
                    .sort(([,a], [,b]) => b.fw2024 - a.fw2024);
                
            const fwBrands = fwSortedData.map(([brand]) => brand);
            const fw2024Values = fwSortedData.map(([,data]) => data.fw2024);
            const fw2023Values = fwSortedData.map(([,data]) => data.fw2023);
            
            // FW ì´ ë§¤ì¶œ ê³„ì‚° (êµ¬ì„±ë¹„ìš©)
            const fwTotal = fw2024Values.reduce((sum, val) => sum + val, 0);
            
            const fwData = [{
                x: fwBrands,
                y: fw2024Values,
                type: 'bar',
                name: '24FW',
                marker: { 
                    color: fwBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? '#FF6B35' : '#2ca02c'),
                    line: { 
                        color: fwBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? '#FF4500' : '#2ca02c'),
                        width: fwBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? 3 : 1)
                    }
                },
                text: fw2024Values.map(val => `${val.toLocaleString()}<br><span style="font-size: 0.8em;">(${((val/fwTotal)*100).toFixed(1)}%)</span>`),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>24FW: %{y:,.0f}<br>êµ¬ì„±ë¹„: %{customdata:.1f}%<extra></extra>',
                customdata: fw2024Values.map(val => (val/fwTotal)*100)
            }, {
                x: fwBrands,
                y: fw2023Values,
                type: 'bar',
                name: '23FW',
                marker: { 
                    color: fwBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? '#FF8C42' : '#d62728'),
                    line: { 
                        color: fwBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? '#FF4500' : '#d62728'),
                        width: fwBrands.map(brand => brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬' ? 3 : 1)
                    }
                },
                text: fw2023Values.map(val => `${val.toLocaleString()}<br><span style="font-size: 0.8em;">(${((val/fwTotal)*100).toFixed(1)}%)</span>`),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>23FW: %{y:,.0f}<br>êµ¬ì„±ë¹„: %{customdata:.1f}%<extra></extra>',
                customdata: fw2023Values.map(val => (val/fwTotal)*100)
            }];

                Plotly.newPlot('msSelectedChart', fwData, {
                title: 'FW ì‹œì¦Œ ë§¤ì¶œ í˜„í™© (ë†’ì€ ë§¤ì¶œ ìˆœ)',
                xaxis: { title: 'ë¸Œëœë“œ' },
                yaxis: { title: 'ë§¤ì¶œ (ì–µì›)' },
                barmode: 'group'
            });

                document.getElementById('msChartTitle').textContent = 'FW ì‹œì¦Œ ë§¤ì¶œ í˜„í™©';
            }
        }

        function updateMSTable(msData) {
            const selectedSeason = document.querySelector('input[name="msSeasonType"]:checked').value;
            const tbody = document.querySelector('#msTable tbody');
            const thead = document.querySelector('#msTableHead');
            tbody.innerHTML = '';

            if (selectedSeason === 'SS') {
                // SS ì‹œì¦Œ ë°ì´í„°ë¥¼ ë§¤ì¶œ ìˆœìœ¼ë¡œ ì •ë ¬
                const ssSortedData = Object.entries(msData)
                    .sort(([,a], [,b]) => b.ss2025 - a.ss2025);
                
                // ì´í•© ê³„ì‚°
                const totalSS2025 = ssSortedData.reduce((sum, [,data]) => sum + data.ss2025, 0);
                const totalSS2024 = ssSortedData.reduce((sum, [,data]) => sum + data.ss2024, 0);
                const totalGrowth = totalSS2024 !== 0 ? ((totalSS2025 - totalSS2024) / totalSS2024 * 100) : 0;
                
                // í—¤ë” ì—…ë°ì´íŠ¸
                thead.innerHTML = `
                    <th>ìˆœìœ„</th>
                    <th>ë¸Œëœë“œ</th>
                    <th>25SS</th>
                    <th>24SS</th>
                    <th>SS ì „ë…„ë¹„</th>
                `;

                // í…Œì´ë¸” ë°ì´í„° ì¶”ê°€
                ssSortedData.forEach(([brand, data], index) => {
                    const row = tbody.insertRow();
                    const rank = index + 1;
                    
                    // ë””ìŠ¤ì»¤ë²„ë¦¬ ê°•ì¡° ìŠ¤íƒ€ì¼
                    if (brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬') {
                        row.style.backgroundColor = '#FFF5F0';
                        row.style.fontWeight = 'bold';
                        row.style.border = '2px solid #FF6B35';
                    }
                    
                    row.insertCell(0).innerHTML = `<span style="font-weight: bold; color: ${rank <= 3 ? '#FF6B35' : '#333'}; font-size: 1.1em;">${rank}</span>`;
                    
                    // ë¸Œëœë“œëª…
                    const brandCell = row.insertCell(1);
                    brandCell.textContent = brand;
                    if (brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬') {
                        brandCell.style.color = '#FF6B35';
                        brandCell.style.fontWeight = 'bold';
                    }
                    
                    // 25SS (êµ¬ì„±ë¹„ í¬í•¨)
                    const ss2025Cell = row.insertCell(2);
                    const ss2025Composition = ((data.ss2025 / totalSS2025) * 100).toFixed(1);
                    ss2025Cell.innerHTML = `${formatToHundredMillion(data.ss2025)}<br><span style="font-size: 0.8em; color: #666;">(${ss2025Composition}%)</span>`;
                    
                    // 24SS (êµ¬ì„±ë¹„ í¬í•¨)
                    const ss2024Cell = row.insertCell(3);
                    const ss2024Composition = ((data.ss2024 / totalSS2024) * 100).toFixed(1);
                    ss2024Cell.innerHTML = `${formatToHundredMillion(data.ss2024)}<br><span style="font-size: 0.8em; color: #666;">(${ss2024Composition}%)</span>`;
                    
                    const growthCell = row.insertCell(4);
                    const growthText = data.ssGrowth >= 0 ? `+${data.ssGrowth.toFixed(1)}%` : `${data.ssGrowth.toFixed(1)}%`;
                    growthCell.innerHTML = `<span style="color: ${data.ssGrowth >= 0 ? '#0066cc' : '#cc0000'}; font-weight: bold;">${growthText}</span>`;
                });

                // í•©ê³„ í–‰ ì¶”ê°€
                const totalRow = tbody.insertRow();
                totalRow.style.backgroundColor = '#f8f9fa';
                totalRow.style.fontWeight = 'bold';
                totalRow.style.borderTop = '3px solid #333';
                
                totalRow.insertCell(0).innerHTML = '<span style="color: #333; font-size: 1.1em;">í•©ê³„</span>';
                totalRow.insertCell(1).textContent = 'ì „ì²´';
                totalRow.insertCell(2).innerHTML = `${formatToHundredMillion(totalSS2025)}<br><span style="font-size: 0.8em; color: #666;">(100.0%)</span>`;
                totalRow.insertCell(3).innerHTML = `${formatToHundredMillion(totalSS2024)}<br><span style="font-size: 0.8em; color: #666;">(100.0%)</span>`;
                
                const totalGrowthCell = totalRow.insertCell(4);
                const totalGrowthText = totalGrowth >= 0 ? `+${totalGrowth.toFixed(1)}%` : `${totalGrowth.toFixed(1)}%`;
                totalGrowthCell.innerHTML = `<span style="color: ${totalGrowth >= 0 ? '#0066cc' : '#cc0000'}; font-weight: bold; font-size: 1.1em;">${totalGrowthText}</span>`;
                
            } else {
                // FW ì‹œì¦Œ ë°ì´í„°ë¥¼ ë§¤ì¶œ ìˆœìœ¼ë¡œ ì •ë ¬
                const fwSortedData = Object.entries(msData)
                    .sort(([,a], [,b]) => b.fw2024 - a.fw2024);
                
                // ì´í•© ê³„ì‚°
                const totalFW2024 = fwSortedData.reduce((sum, [,data]) => sum + data.fw2024, 0);
                const totalFW2023 = fwSortedData.reduce((sum, [,data]) => sum + data.fw2023, 0);
                const totalGrowth = totalFW2023 !== 0 ? ((totalFW2024 - totalFW2023) / totalFW2023 * 100) : 0;
                
                // í—¤ë” ì—…ë°ì´íŠ¸
                thead.innerHTML = `
                    <th>ìˆœìœ„</th>
                    <th>ë¸Œëœë“œ</th>
                    <th>24FW</th>
                    <th>23FW</th>
                    <th>FW ì „ë…„ë¹„</th>
                `;

                // í…Œì´ë¸” ë°ì´í„° ì¶”ê°€
                fwSortedData.forEach(([brand, data], index) => {
                    const row = tbody.insertRow();
                    const rank = index + 1;
                    
                    // ë””ìŠ¤ì»¤ë²„ë¦¬ ê°•ì¡° ìŠ¤íƒ€ì¼
                    if (brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬') {
                        row.style.backgroundColor = '#FFF5F0';
                        row.style.fontWeight = 'bold';
                        row.style.border = '2px solid #FF6B35';
                    }
                    
                    row.insertCell(0).innerHTML = `<span style="font-weight: bold; color: ${rank <= 3 ? '#FF6B35' : '#333'}; font-size: 1.1em;">${rank}</span>`;
                    
                    // ë¸Œëœë“œëª…
                    const brandCell = row.insertCell(1);
                    brandCell.textContent = brand;
                    if (brand === 'ë””ìŠ¤ì»¤ë²„ë¦¬') {
                        brandCell.style.color = '#FF6B35';
                        brandCell.style.fontWeight = 'bold';
                    }
                    
                    // 24FW (êµ¬ì„±ë¹„ í¬í•¨)
                    const fw2024Cell = row.insertCell(2);
                    const fw2024Composition = ((data.fw2024 / totalFW2024) * 100).toFixed(1);
                    fw2024Cell.innerHTML = `${formatToHundredMillion(data.fw2024)}<br><span style="font-size: 0.8em; color: #666;">(${fw2024Composition}%)</span>`;
                    
                    // 23FW (êµ¬ì„±ë¹„ í¬í•¨)
                    const fw2023Cell = row.insertCell(3);
                    const fw2023Composition = ((data.fw2023 / totalFW2023) * 100).toFixed(1);
                    fw2023Cell.innerHTML = `${formatToHundredMillion(data.fw2023)}<br><span style="font-size: 0.8em; color: #666;">(${fw2023Composition}%)</span>`;
                    
                    const growthCell = row.insertCell(4);
                    const growthText = data.fwGrowth >= 0 ? `+${data.fwGrowth.toFixed(1)}%` : `${data.fwGrowth.toFixed(1)}%`;
                    growthCell.innerHTML = `<span style="color: ${data.fwGrowth >= 0 ? '#0066cc' : '#cc0000'}; font-weight: bold;">${growthText}</span>`;
                });

                // í•©ê³„ í–‰ ì¶”ê°€
                const totalRow = tbody.insertRow();
                totalRow.style.backgroundColor = '#f8f9fa';
                totalRow.style.fontWeight = 'bold';
                totalRow.style.borderTop = '3px solid #333';
                
                totalRow.insertCell(0).innerHTML = '<span style="color: #333; font-size: 1.1em;">í•©ê³„</span>';
                totalRow.insertCell(1).textContent = 'ì „ì²´';
                totalRow.insertCell(2).innerHTML = `${formatToHundredMillion(totalFW2024)}<br><span style="font-size: 0.8em; color: #666;">(100.0%)</span>`;
                totalRow.insertCell(3).innerHTML = `${formatToHundredMillion(totalFW2023)}<br><span style="font-size: 0.8em; color: #666;">(100.0%)</span>`;
                
                const totalGrowthCell = totalRow.insertCell(4);
                const totalGrowthText = totalGrowth >= 0 ? `+${totalGrowth.toFixed(1)}%` : `${totalGrowth.toFixed(1)}%`;
                totalGrowthCell.innerHTML = `<span style="color: ${totalGrowth >= 0 ? '#0066cc' : '#cc0000'}; font-weight: bold; font-size: 1.1em;">${totalGrowthText}</span>`;
            }
        }

        function updateTables() {
            // ì•„ìš¸ë › ë§¤ì¶œ íë¦„ í…Œì´ë¸”ì€ í•­ìƒ ì „ì²´ ë°ì´í„°ë¡œ ê³ ì •
            updateDistributorTable();
        }

        function updateSummaryTable(distributorData) {
            const tbody = document.querySelector('#summaryTable tbody');
            const thead = document.querySelector('#summaryTableHead tr');
            tbody.innerHTML = '';

            // ì„ íƒëœ ì‹œì¦Œ íƒ€ì… í™•ì¸
            const selectedSeason = document.querySelector('input[name="seasonType"]:checked').value;
            
            // í—¤ë” ì—…ë°ì´íŠ¸
            if (selectedSeason === 'SS') {
                thead.innerHTML = `
                    <th>ìœ í†µì‚¬</th>
                    <th>ë§¤ì¥ìˆ˜</th>
                    <th>25SS ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                    <th>24SS ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                    <th>SS ì´ë§¤ì¶œ ì „ë…„ë¹„</th>
                    <th>25SS í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                    <th>24SS í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                    <th>SS í‰ê· ë§¤ì¶œ ì „ë…„ë¹„</th>
                `;
            } else {
                thead.innerHTML = `
                    <th>ìœ í†µì‚¬</th>
                    <th>ë§¤ì¥ìˆ˜</th>
                    <th>24FW ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                    <th>23FW ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                    <th>FW ì´ë§¤ì¶œ ì „ë…„ë¹„</th>
                    <th>24FW í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                    <th>23FW í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)</th>
                    <th>FW í‰ê· ë§¤ì¶œ ì „ë…„ë¹„</th>
                `;
            }

            // ì „ì²´ ì´ë§¤ì¶œê³¼ í‰ê· ë§¤ì¶œ ê³„ì‚° (êµ¬ì„±ë¹„ìš©)
            let totalSalesSum = 0;
            let totalAvgSum = 0;
            
            Object.entries(distributorData).forEach(([distributor, data]) => {
                if (selectedSeason === 'SS') {
                    totalSalesSum += data.ss2025;
                    totalAvgSum += data.avgSS2025;
                } else {
                    totalSalesSum += data.fw2024;
                    totalAvgSum += data.avgFW2024;
                }
            });

            // ê° ìœ í†µì‚¬ë³„ ë°ì´í„° í‘œì‹œ
            Object.entries(distributorData).forEach(([distributor, data]) => {
                const row = tbody.insertRow();
                
                if (selectedSeason === 'SS') {
                    const salesComposition2025 = ((data.ss2025 / totalSalesSum) * 100).toFixed(1);
                    const salesComposition2024 = ((data.ss2024 / totalSalesSum) * 100).toFixed(1);
                    const avgComposition2025 = ((data.avgSS2025 / totalAvgSum) * 100).toFixed(1);
                    const avgComposition2024 = ((data.avgSS2024 / totalAvgSum) * 100).toFixed(1);
                    const salesGrowth = data.ss2024 !== 0 ? (((data.ss2025 - data.ss2024) / data.ss2024) * 100) : 0;
                    const avgGrowth = data.avgSS2024 !== 0 ? (((data.avgSS2025 - data.avgSS2024) / data.avgSS2024) * 100) : 0;
                    
                    row.insertCell(0).textContent = distributor;
                    row.insertCell(1).textContent = data.storeCount;
                    
                    // 25SS ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)
                    const cell2025 = row.insertCell(2);
                    cell2025.innerHTML = `${formatToHundredMillion(data.ss2025)}<br><span style="font-size: 0.8em; color: #666;">(${salesComposition2025}%)</span>`;
                    
                    // 24SS ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)
                    const cell2024 = row.insertCell(3);
                    cell2024.innerHTML = `${formatToHundredMillion(data.ss2024)}<br><span style="font-size: 0.8em; color: #666;">(${salesComposition2024}%)</span>`;
                    
                    // SS ì´ë§¤ì¶œ ì „ë…„ë¹„ (ìƒ‰ìƒ ì ìš©)
                    const salesGrowthCell = row.insertCell(4);
                    const salesGrowthText = salesGrowth >= 0 ? `+${salesGrowth.toFixed(1)}%` : `${salesGrowth.toFixed(1)}%`;
                    salesGrowthCell.innerHTML = `<span style="color: ${salesGrowth >= 0 ? '#0066cc' : '#cc0000'};">${salesGrowthText}</span>`;
                    
                    // 25SS í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)
                    const avgCell2025 = row.insertCell(5);
                    avgCell2025.innerHTML = `${formatToHundredMillion(data.avgSS2025)}<br><span style="font-size: 0.8em; color: #666;">(${avgComposition2025}%)</span>`;
                    
                    // 24SS í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)
                    const avgCell2024 = row.insertCell(6);
                    avgCell2024.innerHTML = `${formatToHundredMillion(data.avgSS2024)}<br><span style="font-size: 0.8em; color: #666;">(${avgComposition2024}%)</span>`;
                    
                    // SS í‰ê· ë§¤ì¶œ ì „ë…„ë¹„ (ìƒ‰ìƒ ì ìš©)
                    const avgGrowthCell = row.insertCell(7);
                    const avgGrowthText = avgGrowth >= 0 ? `+${avgGrowth.toFixed(1)}%` : `${avgGrowth.toFixed(1)}%`;
                    avgGrowthCell.innerHTML = `<span style="color: ${avgGrowth >= 0 ? '#0066cc' : '#cc0000'};">${avgGrowthText}</span>`;
                } else {
                    const salesComposition2024 = ((data.fw2024 / totalSalesSum) * 100).toFixed(1);
                    const salesComposition2023 = ((data.fw2023 / totalSalesSum) * 100).toFixed(1);
                    const avgComposition2024 = ((data.avgFW2024 / totalAvgSum) * 100).toFixed(1);
                    const avgComposition2023 = ((data.avgFW2023 / totalAvgSum) * 100).toFixed(1);
                    const salesGrowth = data.fw2023 !== 0 ? (((data.fw2024 - data.fw2023) / data.fw2023) * 100) : 0;
                    const avgGrowth = data.avgFW2023 !== 0 ? (((data.avgFW2024 - data.avgFW2023) / data.avgFW2023) * 100) : 0;
                    
                    row.insertCell(0).textContent = distributor;
                    row.insertCell(1).textContent = data.storeCount;
                    
                    // 24FW ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)
                    const cell2024 = row.insertCell(2);
                    cell2024.innerHTML = `${formatToHundredMillion(data.fw2024)}<br><span style="font-size: 0.8em; color: #666;">(${salesComposition2024}%)</span>`;
                    
                    // 23FW ì´ë§¤ì¶œ(êµ¬ì„±ë¹„)
                    const cell2023 = row.insertCell(3);
                    cell2023.innerHTML = `${formatToHundredMillion(data.fw2023)}<br><span style="font-size: 0.8em; color: #666;">(${salesComposition2023}%)</span>`;
                    
                    // FW ì´ë§¤ì¶œ ì „ë…„ë¹„ (ìƒ‰ìƒ ì ìš©)
                    const salesGrowthCell = row.insertCell(4);
                    const salesGrowthText = salesGrowth >= 0 ? `+${salesGrowth.toFixed(1)}%` : `${salesGrowth.toFixed(1)}%`;
                    salesGrowthCell.innerHTML = `<span style="color: ${salesGrowth >= 0 ? '#0066cc' : '#cc0000'};">${salesGrowthText}</span>`;
                    
                    // 24FW í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)
                    const avgCell2024 = row.insertCell(5);
                    avgCell2024.innerHTML = `${formatToHundredMillion(data.avgFW2024)}<br><span style="font-size: 0.8em; color: #666;">(${avgComposition2024}%)</span>`;
                    
                    // 23FW í‰ê· ë§¤ì¶œ(êµ¬ì„±ë¹„)
                    const avgCell2023 = row.insertCell(6);
                    avgCell2023.innerHTML = `${formatToHundredMillion(data.avgFW2023)}<br><span style="font-size: 0.8em; color: #666;">(${avgComposition2023}%)</span>`;
                    
                    // FW í‰ê· ë§¤ì¶œ ì „ë…„ë¹„ (ìƒ‰ìƒ ì ìš©)
                    const avgGrowthCell = row.insertCell(7);
                    const avgGrowthText = avgGrowth >= 0 ? `+${avgGrowth.toFixed(1)}%` : `${avgGrowth.toFixed(1)}%`;
                    avgGrowthCell.innerHTML = `<span style="color: ${avgGrowth >= 0 ? '#0066cc' : '#cc0000'};">${avgGrowthText}</span>`;
                }
            });
        }

        function updateDistributorTable() {
            const tbody = document.querySelector('#distributorTable tbody');
            tbody.innerHTML = '';

            // ì„ íƒëœ ë°ì´í„° íƒ€ì… í™•ì¸
            const selectedDataType = document.querySelector('input[name="distributorDataType"]:checked').value;

            // ì•„ìš¸ë › ë§¤ì¶œ íë¦„ í…Œì´ë¸”ì€ ë””ìŠ¤ì»¤ë²„ë¦¬ ë¸Œëœë“œë§Œ í‘œì‹œ
            const discoveryData = rawData.filter(row => row['ë¸Œëœë“œ'] === 'ë””ìŠ¤ì»¤ë²„ë¦¬');
            const distributors = [...new Set(discoveryData.map(row => row['ìœ í†µì‚¬']))].filter(Boolean);
            
            distributors.forEach(distributor => {
                const row = tbody.insertRow();
                const distributorRows = discoveryData.filter(row => row['ìœ í†µì‚¬'] === distributor);
                
                // ë§¤ì¥ ìˆ˜ ê³„ì‚°
                const storeCount = [...new Set(distributorRows.map(row => row['ë§¤ì¥ëª…']))].length;
                
                row.insertCell(0).textContent = distributor;
                row.insertCell(1).textContent = storeCount;
                
                if (selectedDataType === 'total') {
                    // ì´ ë§¤ì¶œ
                    const ss2025 = distributorRows.reduce((sum, row) => sum + (parseInt(row['25SS']) || 0), 0);
                    const ss2024 = distributorRows.reduce((sum, row) => sum + (parseInt(row['24SS']) || 0), 0);
                    const fw2024 = distributorRows.reduce((sum, row) => sum + (parseInt(row['24FW']) || 0), 0);
                    const fw2023 = distributorRows.reduce((sum, row) => sum + (parseInt(row['23FW']) || 0), 0);
                    
                    const ssGrowth = ss2024 !== 0 ? (((ss2025 - ss2024) / ss2024) * 100) : 0;
                    const fwGrowth = fw2023 !== 0 ? (((fw2024 - fw2023) / fw2023) * 100) : 0;
                    
                    row.insertCell(2).textContent = formatToHundredMillion(ss2025);
                    row.insertCell(3).textContent = formatToHundredMillion(ss2024);
                    
                    const ssGrowthCell = row.insertCell(4);
                    const ssGrowthText = ssGrowth >= 0 ? `+${ssGrowth.toFixed(1)}%` : `${ssGrowth.toFixed(1)}%`;
                    ssGrowthCell.innerHTML = `<span style="color: ${ssGrowth >= 0 ? '#0066cc' : '#cc0000'};">${ssGrowthText}</span>`;
                    
                    row.insertCell(5).textContent = formatToHundredMillion(fw2024);
                    row.insertCell(6).textContent = formatToHundredMillion(fw2023);
                    
                    const fwGrowthCell = row.insertCell(7);
                    const fwGrowthText = fwGrowth >= 0 ? `+${fwGrowth.toFixed(1)}%` : `${fwGrowth.toFixed(1)}%`;
                    fwGrowthCell.innerHTML = `<span style="color: ${fwGrowth >= 0 ? '#0066cc' : '#cc0000'};">${fwGrowthText}</span>`;
                } else {
                    // í‰ê·  ë§¤ì¶œ
                    const ss2025 = distributorRows.reduce((sum, row) => sum + (parseInt(row['25SS']) || 0), 0) / storeCount;
                    const ss2024 = distributorRows.reduce((sum, row) => sum + (parseInt(row['24SS']) || 0), 0) / storeCount;
                    const fw2024 = distributorRows.reduce((sum, row) => sum + (parseInt(row['24FW']) || 0), 0) / storeCount;
                    const fw2023 = distributorRows.reduce((sum, row) => sum + (parseInt(row['23FW']) || 0), 0) / storeCount;
                    
                    const ssGrowth = ss2024 !== 0 ? (((ss2025 - ss2024) / ss2024) * 100) : 0;
                    const fwGrowth = fw2023 !== 0 ? (((fw2024 - fw2023) / fw2023) * 100) : 0;
                    
                    row.insertCell(2).textContent = formatToHundredMillion(ss2025);
                    row.insertCell(3).textContent = formatToHundredMillion(ss2024);
                    
                    const ssGrowthCell = row.insertCell(4);
                    const ssGrowthText = ssGrowth >= 0 ? `+${ssGrowth.toFixed(1)}%` : `${ssGrowth.toFixed(1)}%`;
                    ssGrowthCell.innerHTML = `<span style="color: ${ssGrowth >= 0 ? '#0066cc' : '#cc0000'};">${ssGrowthText}</span>`;
                    
                    row.insertCell(5).textContent = formatToHundredMillion(fw2024);
                    row.insertCell(6).textContent = formatToHundredMillion(fw2023);
                    
                    const fwGrowthCell = row.insertCell(7);
                    const fwGrowthText = fwGrowth >= 0 ? `+${fwGrowth.toFixed(1)}%` : `${fwGrowth.toFixed(1)}%`;
                    fwGrowthCell.innerHTML = `<span style="color: ${fwGrowth >= 0 ? '#0066cc' : '#cc0000'};">${fwGrowthText}</span>`;
                }
            });
        }



        // í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜
        function showPage(pageId) {
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // ì„ íƒëœ í˜ì´ì§€ ë³´ì´ê¸°
            document.getElementById(pageId).classList.add('active');
            
            // ì„ íƒëœ íƒ­ ë²„íŠ¼ í™œì„±í™”
            event.target.classList.add('active');
            
            // ë§¤ì¥ íš¨ìœ¨ í˜ì´ì§€ê°€ ì„ íƒë˜ë©´ ì°¨íŠ¸ ë¡œë“œ
            if (pageId === 'storeEfficiencyPage') {
                loadStoreEfficiencyCharts();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            // ìë™ìœ¼ë¡œ ë°ì´í„° ë¡œë“œ
            updateLoadStatus('ğŸ”„ ë°ì´í„° ë¡œë“œ ì¤‘...', 'loading');
            loadData();
            
            // ë²„íŠ¼ í´ë¦­ ì‹œì—ë„ ìˆ˜ë™ìœ¼ë¡œ ë¡œë“œ ê°€ëŠ¥
            document.getElementById('loadDataBtn').addEventListener('click', function() {
                updateLoadStatus('ğŸ”„ ë°ì´í„° ë¡œë“œ ì¤‘...', 'loading');
                loadData();
            });
            
            // ì‹œì¦Œ íƒ€ì… ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.querySelectorAll('input[name="seasonType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (rawData.length > 0) {
                        updateDistributorCharts();
                    }
                });
            });
            
            // ìœ í†µì‚¬ë³„ ë°ì´í„° íƒ€ì… ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.querySelectorAll('input[name="distributorDataType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (rawData.length > 0) {
                        updateDistributorCharts();
                        updateDistributorTable();
                    }
                });
            });
            
            // SS ì°¨íŠ¸ ë°ì´í„° íƒ€ì… ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.querySelectorAll('input[name="ssChartDataType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (rawData.length > 0) {
                        updateDistributorCharts();
                    }
                });
            });
            
            // FW ì°¨íŠ¸ ë°ì´í„° íƒ€ì… ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.querySelectorAll('input[name="fwChartDataType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (rawData.length > 0) {
                        updateDistributorCharts();
                    }
                });
            });

            // MS ì‹œì¦Œ ì„ íƒ ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.querySelectorAll('input[name="msSeasonType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (rawData.length > 0) {
                        updateMSCharts();
                    }
                });
            });
        });

        // ë§¤ì¥ íš¨ìœ¨ ì°¨íŠ¸ ë¡œë“œ í•¨ìˆ˜
        function loadStoreEfficiencyCharts() {
            try {
                if (rawData.length === 0) {
                    document.getElementById('efficiencyRankingTable').innerHTML = 
                        '<p style="text-align: center; color: #cc0000; padding: 20px;">ë¨¼ì € CSV íŒŒì¼ì„ ë¡œë“œí•´ì£¼ì„¸ìš”.</p>';
                    return;
                }

                // CSV ë°ì´í„°ì—ì„œ íš¨ìœ¨ì„± ë°ì´í„° ìƒì„±
                const efficiencyData = generateEfficiencyData(rawData);
                const seasons = ['23SS', '23FW', '24SS', '24FW', '25SS'];
                
                // 1. íš¨ìœ¨ì„± ìˆœìœ„ í‘œ
                createEfficiencyRankingTable(efficiencyData);
                
                // 2. íš¨ìœ¨ì„± íˆíŠ¸ë§µ ì°¨íŠ¸
                createEfficiencyHeatmapChart(efficiencyData, seasons);
                
                // 3. ë§¤ì¥ë©´ì  vs íš¨ìœ¨ì„± ì‚°ì ë„
                createAreaVsEfficiencyChart(efficiencyData);
                
                // 4. ì‹œì¦Œë³„ ë§¤ì¶œì•¡ íŠ¸ë Œë“œ ì°¨íŠ¸
                createSeasonalTrendChart(efficiencyData, seasons);
                
            } catch (error) {
                console.error('ë§¤ì¥ íš¨ìœ¨ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                document.getElementById('efficiencyRankingTable').innerHTML = 
                    '<p style="text-align: center; color: #cc0000; padding: 20px;">ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</p>';
            }
        }

        // CSV ë°ì´í„°ì—ì„œ íš¨ìœ¨ì„± ë°ì´í„° ìƒì„± (ë””ìŠ¤ì»¤ë²„ë¦¬ ë¸Œëœë“œë§Œ)
        function generateEfficiencyData(data) {
            const storeData = {};
            
            // ë””ìŠ¤ì»¤ë²„ë¦¬ ë¸Œëœë“œë§Œ í•„í„°ë§
            const discoveryData = data.filter(row => row['ë¸Œëœë“œ'] === 'ë””ìŠ¤ì»¤ë²„ë¦¬');
            
            // ë§¤ì¥ë³„ ë°ì´í„° ì§‘ê³„
            discoveryData.forEach(row => {
                const storeName = row['ë§¤ì¥ëª…'];
                const distributor = row['ìœ í†µì‚¬'];
                const area = parseFloat(row['ë§¤ì¥ ë©´ì ']) || 0; // Jì—´ì˜ 'ë§¤ì¥ ë©´ì ' ì»¬ëŸ¼ ì‚¬ìš©
                const areaPyeong = area / 3.3058; // í‰ë°©ë¯¸í„°ë¥¼ í‰ìœ¼ë¡œ ë³€í™˜
                
                if (!storeData[storeName]) {
                    storeData[storeName] = {
                        ë§¤ì¥ëª…: storeName,
                        ìœ í†µì‚¬: distributor,
                        ë§¤ì¥ë©´ì : area,
                        ë§¤ì¥ë©´ì _í‰: areaPyeong,
                        '23SS_ë§¤ì¶œì•¡': 0,
                        '23FW_ë§¤ì¶œì•¡': 0,
                        '24SS_ë§¤ì¶œì•¡': 0,
                        '24FW_ë§¤ì¶œì•¡': 0,
                        '25SS_ë§¤ì¶œì•¡': 0,
                        '23SS_íš¨ìœ¨ì„±': 0,
                        '23FW_íš¨ìœ¨ì„±': 0,
                        '24SS_íš¨ìœ¨ì„±': 0,
                        '24FW_íš¨ìœ¨ì„±': 0,
                        '25SS_íš¨ìœ¨ì„±': 0,
                        í‰ê· íš¨ìœ¨ì„±: 0
                    };
                }
                
                // ì‹œì¦Œë³„ ë§¤ì¶œì•¡ ëˆ„ì 
                const seasons = ['23SS', '23FW', '24SS', '24FW', '25SS'];
                seasons.forEach(season => {
                    const sales = parseInt(row[season]) || 0;
                    storeData[storeName][`${season}_ë§¤ì¶œì•¡`] += sales;
                });
            });
            
            // íš¨ìœ¨ì„± ê³„ì‚° ë° ì •ë ¬
            const efficiencyArray = Object.values(storeData).map(store => {
                const seasons = ['23SS', '23FW', '24SS', '24FW', '25SS'];
                let totalEfficiency = 0;
                let validSeasons = 0;
                
                seasons.forEach(season => {
                    const sales = store[`${season}_ë§¤ì¶œì•¡`];
                    const efficiency = store.ë§¤ì¥ë©´ì _í‰ > 0 ? sales / store.ë§¤ì¥ë©´ì _í‰ : 0;
                    store[`${season}_íš¨ìœ¨ì„±`] = efficiency;
                    
                    if (efficiency > 0) {
                        totalEfficiency += efficiency;
                        validSeasons++;
                    }
                });
                
                store.í‰ê· íš¨ìœ¨ì„± = validSeasons > 0 ? totalEfficiency / validSeasons : 0;
                return store;
            });
            
            // í‰ê·  íš¨ìœ¨ì„± ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            return efficiencyArray.sort((a, b) => b.í‰ê· íš¨ìœ¨ì„± - a.í‰ê· íš¨ìœ¨ì„±);
        }

        // íš¨ìœ¨ì„± ìˆœìœ„ í‘œ ìƒì„±
        function createEfficiencyRankingTable(data) {
            const tableContainer = document.getElementById('efficiencyRankingTable');
            
            // í‘œ HTML ìƒì„±
            let tableHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <th style="padding: 15px; text-align: center; border: none;">ìˆœìœ„</th>
                                <th style="padding: 15px; text-align: left; border: none;">ë§¤ì¥ëª…</th>
                                <th style="padding: 15px; text-align: center; border: none;">ìœ í†µì‚¬</th>
                                <th style="padding: 15px; text-align: center; border: none;">ë§¤ì¥ë©´ì (ã¡)</th>
                                <th style="padding: 15px; text-align: center; border: none;">ë§¤ì¥ë©´ì (í‰)</th>
                                <th style="padding: 15px; text-align: center; border: none;">í‰ê·  íš¨ìœ¨ì„±</th>
                                <th style="padding: 15px; text-align: center; border: none;">23SS íš¨ìœ¨ì„±</th>
                                <th style="padding: 15px; text-align: center; border: none;">23FW íš¨ìœ¨ì„±</th>
                                <th style="padding: 15px; text-align: center; border: none;">24SS íš¨ìœ¨ì„±</th>
                                <th style="padding: 15px; text-align: center; border: none;">24FW íš¨ìœ¨ì„±</th>
                                <th style="padding: 15px; text-align: center; border: none;">25SS íš¨ìœ¨ì„±</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // ë°ì´í„° í–‰ ìƒì„±
            data.forEach((store, index) => {
                const rank = index + 1;
                const rankColor = rank <= 3 ? '#ffd700' : rank <= 10 ? '#c0c0c0' : '#cd7f32';
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #eee; transition: background-color 0.3s;" 
                        onmouseover="this.style.backgroundColor='#f8f9fa'" 
                        onmouseout="this.style.backgroundColor='white'">
                        <td style="padding: 12px; text-align: center; border: none;">
                            <span style="display: inline-block; width: 25px; height: 25px; background: ${rankColor}; color: white; border-radius: 50%; line-height: 25px; font-weight: bold;">${rank}</span>
                        </td>
                        <td style="padding: 12px; text-align: left; border: none; font-weight: 500;">${store.ë§¤ì¥ëª…}</td>
                        <td style="padding: 12px; text-align: center; border: none;">${store.ìœ í†µì‚¬}</td>
                        <td style="padding: 12px; text-align: center; border: none;">${store.ë§¤ì¥ë©´ì .toFixed(1)}</td>
                        <td style="padding: 12px; text-align: center; border: none;">${store.ë§¤ì¥ë©´ì _í‰.toFixed(1)}</td>
                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold; color: #2c3e50;">${Math.round(store.í‰ê· íš¨ìœ¨ì„±).toLocaleString()}ì›/í‰</td>
                        <td style="padding: 12px; text-align: center; border: none;">${Math.round(store['23SS_íš¨ìœ¨ì„±']).toLocaleString()}ì›/í‰</td>
                        <td style="padding: 12px; text-align: center; border: none;">${Math.round(store['23FW_íš¨ìœ¨ì„±']).toLocaleString()}ì›/í‰</td>
                        <td style="padding: 12px; text-align: center; border: none;">${Math.round(store['24SS_íš¨ìœ¨ì„±']).toLocaleString()}ì›/í‰</td>
                        <td style="padding: 12px; text-align: center; border: none;">${Math.round(store['24FW_íš¨ìœ¨ì„±']).toLocaleString()}ì›/í‰</td>
                        <td style="padding: 12px; text-align: center; border: none;">${Math.round(store['25SS_íš¨ìœ¨ì„±']).toLocaleString()}ì›/í‰</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                    <p style="margin: 0; color: #666; font-size: 14px;">
                        <strong>ğŸ“Š ë¶„ì„ ê¸°ì¤€:</strong> í‰ë‹¹ ë§¤ì¶œì•¡ = ë””ìŠ¤ì»¤ë²„ë¦¬ ì´ ë§¤ì¶œì•¡ Ã· ë§¤ì¥ë©´ì (í‰)<br>
                        <strong>ğŸ† ìˆœìœ„ ê¸°ì¤€:</strong> í‰ê·  íš¨ìœ¨ì„± (23SS~25SS ì‹œì¦Œ í‰ê· ) ë†’ì€ ìˆœ<br>
                        <strong>ğŸ“ˆ íš¨ìœ¨ì„±:</strong> ë§¤ì¥ ë©´ì  ëŒ€ë¹„ ë””ìŠ¤ì»¤ë²„ë¦¬ ë§¤ì¶œì•¡ìœ¼ë¡œ ê³µê°„ í™œìš© íš¨ìœ¨ì„± ì¸¡ì •<br>
                        <strong>ğŸ¯ ëŒ€ìƒ:</strong> ë””ìŠ¤ì»¤ë²„ë¦¬ ë¸Œëœë“œ ë§¤ì¥ë§Œ ë¶„ì„
                    </p>
                </div>
            `;
            
            tableContainer.innerHTML = tableHTML;
        }

        // íš¨ìœ¨ì„± íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„±
        function createEfficiencyHeatmapChart(data, seasons) {
            const storeNames = data.map(item => item.ë§¤ì¥ëª…);
            const heatmapData = [];
            
            seasons.forEach(season => {
                const seasonData = data.map(item => item[`${season}_íš¨ìœ¨ì„±`]);
                heatmapData.push(seasonData);
            });
            
            const trace = {
                z: heatmapData,
                x: storeNames,
                y: seasons,
                type: 'heatmap',
                colorscale: 'Viridis',
                text: heatmapData.map(row => row.map(val => val.toLocaleString() + 'ì›/í‰')),
                texttemplate: '%{text}',
                textfont: { size: 8 },
                hovertemplate: '<b>%{y}</b><br>%{x}<br>íš¨ìœ¨ì„±: %{z:,.0f}ì›/í‰<extra></extra>'
            };
            
            const layout = {
                title: 'ë””ìŠ¤ì»¤ë²„ë¦¬ ë§¤ì¥ ì‹œì¦Œë³„ íš¨ìœ¨ì„± íˆíŠ¸ë§µ (í‰ë‹¹ ë§¤ì¶œì•¡)',
                xaxis: { title: 'ë§¤ì¥ëª…', tickangle: -45 },
                yaxis: { title: 'ì‹œì¦Œ' },
                height: 500,
                margin: { b: 100 }
            };
            
            Plotly.newPlot('efficiencyHeatmapChart', [trace], layout);
        }

        // ë§¤ì¥ë©´ì  vs íš¨ìœ¨ì„± ì‚°ì ë„ ìƒì„±
        function createAreaVsEfficiencyChart(data) {
            const trace = {
                x: data.map(item => item.ë§¤ì¥ë©´ì _í‰),
                y: data.map(item => item.í‰ê· íš¨ìœ¨ì„±),
                mode: 'markers+text',
                text: data.map(item => item.ë§¤ì¥ëª…),
                textposition: 'top center',
                marker: {
                    size: 12,
                    color: data.map(item => item.í‰ê· íš¨ìœ¨ì„±),
                    colorscale: 'Viridis',
                    showscale: true,
                    colorbar: { title: "í‰ê·  íš¨ìœ¨ì„± (ì›/í‰)" },
                    line: { width: 1, color: 'white' }
                },
                name: 'ë§¤ì¥',
                hovertemplate: '<b>%{text}</b><br>ë§¤ì¥ë©´ì : %{x:.1f}í‰<br>í‰ê·  íš¨ìœ¨ì„±: %{y:,.0f}ì›/í‰<extra></extra>'
            };
            
            const layout = {
                title: 'ë””ìŠ¤ì»¤ë²„ë¦¬ ë§¤ì¥ë©´ì  vs í‰ê· íš¨ìœ¨ì„±',
                xaxis: { title: 'ë§¤ì¥ë©´ì  (í‰)' },
                yaxis: { title: 'í‰ê·  íš¨ìœ¨ì„± (ì›/í‰)' },
                height: 500,
                hovermode: 'closest'
            };
            
            Plotly.newPlot('areaVsEfficiencyChart', [trace], layout);
        }

        // ì‹œì¦Œë³„ ë§¤ì¶œì•¡ íŠ¸ë Œë“œ ì°¨íŠ¸ ìƒì„±
        function createSeasonalTrendChart(data, seasons) {
            const traces = [];
            const topStores = data.slice(0, 10); // ìƒìœ„ 10ê°œ ë§¤ì¥
            
            topStores.forEach(store => {
                const seasonSales = seasons.map(season => store[`${season}_ë§¤ì¶œì•¡`] / 100000000); // ì–µì› ë‹¨ìœ„ë¡œ ë³€í™˜
                
                traces.push({
                    x: seasons,
                    y: seasonSales,
                    mode: 'lines+markers',
                    name: store.ë§¤ì¥ëª…,
                    line: { width: 3 },
                    marker: { size: 8 },
                    hovertemplate: '<b>%{fullData.name}</b><br>%{x}<br>ë§¤ì¶œì•¡: %{y:.1f}ì–µì›<extra></extra>'
                });
            });
            
            const layout = {
                title: 'ë””ìŠ¤ì»¤ë²„ë¦¬ ìƒìœ„ 10ê°œ ë§¤ì¥ì˜ ì‹œì¦Œë³„ ë§¤ì¶œì•¡ íŠ¸ë Œë“œ',
                xaxis: { title: 'ì‹œì¦Œ' },
                yaxis: { title: 'ë§¤ì¶œì•¡ (ì–µì›)' },
                height: 500,
                hovermode: 'closest',
                legend: { orientation: 'v', x: 1.02, y: 1 }
            };
            
            Plotly.newPlot('seasonalTrendChart', traces, layout);
        }
    </script>
</body>
</html>
